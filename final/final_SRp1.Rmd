---
title: "Foundations of Computational Math -- Final Exam Part 1"
author: "Sam Reeves"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(igraph)
library(stats)
```

# Part 1. Playing with Pagerank

### 1. The A and B Matrices (5)

> Form the $A$ matrix.  Then, introduce decay and form the $B$ matrix as we did in the course notes.

\[B = 0.85 \times A + \frac{0.15}{n}\]

```{r}
n <- 6
A <- matrix(c(0, 1/2, 1/2, 0, 0, 0,
              0, 0, 0, 0, 0, 0,
              1/3, 1/3, 0, 0, 1/3, 0,
              0, 0, 0, 0, 1/2, 1/2,
              0, 0, 0, 1/2, 0, 1/2,
              0, 0, 0, 1, 0, 0),
            ncol = n, byrow = TRUE,
            dimnames = list(c(1:6), c(1:6)))

B <- 0.85 * A + 0.15 / n
```

### 2. The Rank Vector (5)

> Start with a uniform rank vector $r$ and perform power iterations on $B$ till convergence.  That is, compute the solution $r = B^n \times r$.  Attempt this for a sufficiently large $n$ so that $r$ actually converges.

```{r}
r_i <- rep(1/6, 6)

power_iteration <- function(old_matrix) {
  # Performs one power iteration
  # Returns a new matrix of the same dimensions
  
  new_matrix <- old_matrix
    for (j in seq(1:nrow(old_matrix))) {
      for (k in seq(1:ncol(old_matrix))) {
      new_matrix[j, k] <- old_matrix[j,] %*% old_matrix[,k]
      }
    }
    return(new_matrix)
}

converge <- function(old_matrix, n = 1) {
  # Performs power iterations until values converge
  # Returns the number of iterations and the matrix
  
  new_matrix <- power_iteration(old_matrix)
  n <- n + 1
  
  if (identical(new_matrix, old_matrix)) {
    return(list(n, new_matrix))
  } else {
    converge(new_matrix, n)
  }
}

converge(B)
```


### 3. Eigen-Decomposition (10)

> Compute the eigen-decomposition of $B$ and verify that you indeed get an eigenvalue of 1 as the largest eigenvalue and that its corresponding eigenvector is the same vector that you obtained in the previous power iteration method.  Further, this eigenvector has all positive entries and it sums to 1.

```{r}
eigen(B)
```

### 4. Graph Algorithm (10)

> Use the $graph$ package in R and its $page.rank$ method to compute the PageRank of the graph as given in $A$.  Note that you don't need to apply decay.  The package starts with a connected graph and applies decay internally.  Verify that you do get the same PageRank vector as the two approaches above.

```{r}
edges <- matrix(c(1, 2, 1/2,
                  1, 3, 1/2,
                  3, 1, 1/3,
                  3, 2, 1/3,
                  3, 5, 1/3,
                  4, 5, 1/2,
                  4, 6, 1/2,
                  5, 4, 1/2,
                  5, 6, 1/2,
                  6, 4, 1),
                ncol = 3, byrow = TRUE)

edges_1 <- c(1,2,1,3,3,1,3,2,3,5,4,5,4,6,5,4,5,6,6,4)
g <- graph(edges_1)
```


```{r}
g <- set_edge_attr(g, "w", value = edges[,3])
```

```{r}
plot(g)
page.rank(g)
```

